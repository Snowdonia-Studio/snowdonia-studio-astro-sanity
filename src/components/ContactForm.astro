---
// ContactForm component
---

<section id="contact" class="contact-section">
  <div class="mx-auto mt-20 max-w-screen-md px-4 py-20">
    <h2 class="text-foreground mb-16 text-center text-4xl font-extrabold md:text-7xl">Contact Us</h2>
    <p class="mb-8 text-center font-light sm:text-xl lg:mb-16">
      Need a website built? Need some maintenance or updates? Drop us a line and we'll get back with you as soon as
      possible.
    </p>
    <div id="form-container">
      <!-- Success message will be shown here -->
      <div
        id="success-message"
        class="hidden rounded-lg border border-green-300 bg-green-50 p-6 text-center dark:border-green-700 dark:bg-green-900/20"
      >
        <h3 class="text-2xl font-semibold text-green-800 dark:text-green-200">Thank you!</h3>
        <p class="mt-2 text-green-700 dark:text-green-300">
          Your message has been sent. We'll get back to you shortly.
        </p>
      </div>

      <!-- Contact form -->
      <form id="contact-form" class="space-y-8">
        <div>
          <label for="name" class="mb-2 block text-sm font-medium text-stone-900 dark:text-stone-300">
            Your name
          </label>
          <input
            id="name"
            name="name"
            type="text"
            class="focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-500 dark:focus:border-primary-500 dark:shadow-sm-light block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 shadow-sm dark:border-stone-600 dark:bg-stone-700 dark:text-stone-100 dark:placeholder-stone-400"
            placeholder="Jane Doe"
          />
        </div>
        <div>
          <label for="email" class="mb-2 block text-sm font-medium text-stone-900 dark:text-stone-300">
            Your email
          </label>
          <input
            id="email"
            name="email"
            type="email"
            required
            class="focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-500 dark:focus:border-primary-500 dark:shadow-sm-light block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 shadow-sm dark:border-stone-600 dark:bg-stone-700 dark:text-stone-100 dark:placeholder-stone-400"
            placeholder="you@example.com"
          />
        </div>
        <div>
          <label for="subject" class="mb-2 block text-sm font-medium text-stone-900 dark:text-stone-300">
            Subject
          </label>
          <input
            id="subject"
            name="subject"
            type="text"
            required
            class="focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-500 dark:focus:border-primary-500 dark:shadow-sm-light block w-full rounded-lg border border-gray-300 bg-gray-50 p-3 text-sm text-gray-900 shadow-sm dark:border-stone-600 dark:bg-stone-700 dark:text-stone-100 dark:placeholder-stone-400"
            placeholder="Let us know how we can help you"
          />
        </div>
        <div class="sm:col-span-2">
          <label for="message" class="mb-2 block text-sm font-medium text-stone-900 dark:text-stone-300">
            Your message
          </label>
          <textarea
            id="message"
            name="message"
            required
            rows="6"
            class="focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-500 dark:focus:border-primary-500 block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 shadow-sm dark:border-stone-600 dark:bg-stone-700 dark:text-stone-100 dark:placeholder-stone-400"
            placeholder="Leave a comment..."></textarea>
        </div>
        <div id="error-message" class="hidden text-center text-sm text-red-600 dark:text-red-400"></div>
        <div class="text-center">
          <button
            id="submit-button"
            type="submit"
            class="rounded-lg bg-primary-600 px-8 py-3 text-white transition-colors hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed dark:bg-stone-700 dark:hover:bg-stone-600"
          >
            <span id="submit-text">Work With Us</span>
            <span id="submit-loading" class="hidden">Sendingâ€¦</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
  // @ts-nocheck
  const form = document.getElementById('contact-form');
  const submitButton = document.getElementById('submit-button');
  const submitText = document.getElementById('submit-text');
  const submitLoading = document.getElementById('submit-loading');
  const successMessage = document.getElementById('success-message');
  const errorMessage = document.getElementById('error-message');
  const formContainer = document.getElementById('form-container');

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Reset UI state
      errorMessage.classList.add('hidden');
      submitButton.disabled = true;
      submitText.classList.add('hidden');
      submitLoading.classList.remove('hidden');

      const formData = new FormData(form);

      try {
        const res = await fetch('/api/contact', {
          method: 'POST',
          body: formData,
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok) {
          throw new Error(data?.error || 'Failed to send message');
        }

        // Success - show success message and hide form
        form.style.display = 'none';
        successMessage.classList.remove('hidden');

        // Update URL hash
        if (typeof window !== 'undefined') {
          try {
            const url = new URL(window.location.href);
            url.hash = 'thank-you';
            window.history.replaceState(null, '', url.toString());
          } catch {
            window.location.hash = 'thank-you';
          }
        }

        // Reset form
        form.reset();
      } catch (err) {
        // Show error message
        errorMessage.textContent = err?.message || 'Something went wrong. Please try again.';
        errorMessage.classList.remove('hidden');
      } finally {
        // Reset button state
        submitButton.disabled = false;
        submitText.classList.remove('hidden');
        submitLoading.classList.add('hidden');
      }
    });
  }
</script>

<style>
  .contact-section {
    position: relative;
    z-index: 1;
  }

  .text-foreground {
    color: inherit;
  }

  @media (prefers-color-scheme: dark) {
    .text-foreground {
      color: #f9fafb;
    }
  }
</style>
