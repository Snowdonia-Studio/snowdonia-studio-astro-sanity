---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';
---

<Layout>
  <Header />
  <main class="bg-neutral-900 min-h-screen flex flex-col items-center pt-14 px-4 md:px-8 font-sans">
    
    <div class="max-w-6xl w-full pt-8 md:pt-14 mt-14 mb-14 grid grid-cols-1 md:grid-cols-3 gap-8">
      
      <div class="md:col-span-2 order-1">
        <h1 class="text-3xl md:text-5xl font-black text-teal-200 mb-8 flex items-center gap-3 tracking-tight">
          Website calculator
          <span class="relative inline-block h-4">
            <svg width="90" height="16" viewBox="0 0 90 16" fill="none" class="absolute left-0 top-2">
              <path d="M2 10 Q 20 2, 40 10 T 80 10" stroke="#38bdf8" stroke-width="3" fill="none" />
            </svg>
          </span>
        </h1>
        <p class="text-neutral-100 mb-4 max-w-2xl text-base md:text-lg">
          Use our calculator below to get an estimated cost for your web design project. This tool provides approximate pricing based on your selected requirements.
        </p>
        <p class="font-bold text-white mb-4 max-w-2xl text-sm md:text-base">If your budget doesn’t align with our costs, we’re happy to discuss alternative solutions.</p>
      </div>

      <aside class="md:col-start-3 md:row-start-1 md:row-span-2 order-2 h-fit z-10">
        <div class="bg-neutral-800 rounded-2xl shadow-xl border-2 border-teal-200 px-6 py-7 text-white sticky top-24" id="resultCard">
          <div class="text-xs text-teal-200 mb-2 font-bold" id="resultTotalLabel">TOTAL</div>
          <div class="text-4xl font-black mb-2 text-teal-200" id="totalHours">125 Hours</div>
          <div class="text-2xl font-black mb-1 text-white" id="totalPrice">$13,685</div>
          
          <div class="border-t border-teal-200 pt-3 mt-3 text-base">
            <div class="font-black mb-1 text-teal-200">Included in your pack:</div>
            <ul class="list-disc ml-5 text-white text-sm leading-relaxed" id="includedPack">
              </ul>
          </div>

          <div class="my-6 w-full max-w-2xl mx-auto text-center">
            <a
              id="contactBtnLink"
              href={import.meta.env.GOOGLE_CLIENT_EMAIL}
              class="mt-6 w-full bg-teal-200 text-black font-black py-3 rounded-xl text-lg flex items-center justify-center gap-2 shadow-lg hover:bg-teal-100 transition"
            >
              Schedule a Meeting
            </a>
          </div>
        </div>
      </aside>

      <section class="md:col-span-2 order-3">
        <div class="flex gap-2 mb-8 w-full overflow-x-auto">
          <button id="tabWebsite" class="tab-btn font-black text-base md:text-lg px-6 py-3 rounded-t-lg border-b-4 border-teal-200 bg-neutral-800 text-teal-200 flex-1 md:flex-none">New Build</button>
          <button id="tabRetainer" class="tab-btn font-black text-base md:text-lg px-6 py-3 rounded-t-lg border-b-4 border-transparent bg-neutral-900 text-neutral-400 flex-1 md:flex-none">Maintenance</button>
        </div>

        <div id="websiteSection">
          <div class="flex flex-col md:flex-row gap-4 mb-6">
            <button id="standardBtn" class="flex-1 rounded-xl px-6 py-5 text-left border-2 transition-all bg-neutral-800 border-teal-200 text-white shadow-lg font-bold">
              <div class="text-lg font-black mb-1 text-teal-200">Standard Website</div>
              <div class="text-base text-white">Ideal if you want a clean, efficient site using only native features.</div>
            </button>
            <button id="customBtn" class="flex-1 rounded-xl px-6 py-5 text-left border-2 transition-all bg-neutral-900 border-neutral-700 text-neutral-400 font-bold">
              <div class="text-lg font-black mb-1 text-teal-200">Custom Website</div>
              <div class="text-base text-white">Perfect for a tailored experience, with advanced design and feature customisation.</div>
            </button>
          </div>
          
          <div class="mb-2 font-black text-teal-200 text-lg pt-4">Which extra Features do you need?</div>
          <div class="flex flex-wrap gap-3 mb-3 py-2" id="features">
            <button class="rounded-full px-4 py-2 text-sm md:text-base font-bold border-2 bg-neutral-800 text-white border-teal-200 transition-colors" data-value="ecommerce">eCommerce</button>
            <button class="rounded-full px-4 py-2 text-sm md:text-base font-bold border-2 bg-neutral-800 text-white border-teal-200 transition-colors" data-value="events">Events</button>
            <button class="rounded-full px-4 py-2 text-sm md:text-base font-bold border-2 bg-neutral-800 text-white border-teal-200 transition-colors" data-value="blog">Blog</button>
            <button class="rounded-full px-4 py-2 text-sm md:text-base font-bold border-2 bg-neutral-800 text-white border-teal-200 transition-colors" data-value="elearning">eLearning</button>
            <button class="rounded-full px-4 py-2 text-sm md:text-base font-bold border-2 bg-neutral-800 text-white border-teal-200 transition-colors" data-value="appointment">Appointment</button>
            <button class="rounded-full px-4 py-2 text-sm md:text-base font-bold border-2 bg-neutral-800 text-white border-teal-200 transition-colors" data-value="storelocator">Store Locator</button>
          </div>
          <div class="bg-neutral-800 text-neutral-100 text-xs rounded-lg px-4 py-2 mb-6 border border-teal-200">
            For custom features that are not listed in this form, please contact the web design team.
          </div>

          <div class="mb-2 font-black text-teal-200 text-lg pt-4">How many pages do you have?</div>
          <div class="flex items-center gap-4 mb-2">
            <input type="range" min="1" max="20" value="10" id="pages" class="accent-teal-200 w-full md:w-48 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer" />
            <span class="text-lg font-black text-teal-200 whitespace-nowrap" id="pagesValue">10</span>
          </div>
          <div class="bg-neutral-800 text-neutral-100 text-xs rounded-lg px-4 py-2 mb-6 border border-teal-200">
            For projects of more than 20 pages, please contact the web design team
          </div>
        </div>

        <div id="retainerSection" style="display:none;">
          <div class="flex flex-col md:flex-row gap-4 mb-6 w-full md:w-[50%]">
            <button id="retainerBtn" class="flex-1 rounded-xl px-6 py-5 text-left border-2 transition-all bg-neutral-800 border-teal-200 text-white shadow-lg font-bold border-teal-200 cursor-default">
              <div class="text-lg font-black mb-1 text-teal-200">Retainer Work</div>
              <div class="text-base text-white">Ongoing design, development, or support for your business. Purchase blocks of hours for complete flexibility.</div>
            </button>
          </div>
          <div class="mb-2 font-black text-teal-200 text-lg pt-4">How many hours do you need?</div>
          <div class="flex items-center gap-4 mb-2">
            <input type="range" min="20" max="80" step="5" value="20" id="retainerHours" class="accent-teal-200 w-full md:w-48 h-2 bg-neutral-700 rounded-lg appearance-none cursor-pointer" />
            <span class="text-lg font-black text-teal-200 whitespace-nowrap" id="retainerHoursValue">20</span>
          </div>
          <div class="bg-neutral-800 text-neutral-100 text-xs rounded-lg px-4 py-2 mb-6 border border-teal-200 font-normal">
            Minimum 20 hours per block. You can increase in increments of 5 hours.
          </div>
        </div>
      </section>

    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // State
        let siteType = 'standard'; 
        let features: any[] = [];
        let packs: any[] = [];
        let pages = 10;
        let currency = 'USD';

        // Elements
        const customBtn = document.getElementById('customBtn');
        const standardBtn = document.getElementById('standardBtn');
        const featuresEl = document.getElementById('features');
        const pagesEl = document.getElementById('pages');
        const pagesValue = document.getElementById('pagesValue');
        const contactBtnLink = document.getElementById('contactBtnLink');
        
        // Feature toggles
        if (featuresEl) {
          featuresEl.querySelectorAll('button').forEach(btn => {
            btn.addEventListener('click', () => {
              const val = btn.getAttribute('data-value');
              if (features.includes(val)) {
                features = features.filter(f => f !== val);
                btn.classList.remove('bg-teal-200', 'text-black', 'shadow');
                btn.classList.add('bg-neutral-800', 'text-white');
              } else {
                features.push(val);
                btn.classList.add('bg-teal-200', 'text-black', 'shadow');
                btn.classList.remove('bg-neutral-800', 'text-white');
              }
              updateResult();
            });
          });
        }

        // Site type toggles
        if (customBtn && standardBtn) {
          customBtn.addEventListener('click', () => {
            siteType = 'custom';
            pages = 10;
            if (pagesEl && pagesValue) {
              (pagesEl as HTMLInputElement).value = '10';
              pagesValue.textContent = '10';
            }
            customBtn.classList.add('bg-neutral-800', 'border-teal-200', 'text-white', 'shadow-lg');
            customBtn.classList.remove('bg-neutral-900', 'border-neutral-700', 'text-neutral-400');
            standardBtn.classList.remove('bg-neutral-800', 'border-teal-200', 'text-white', 'shadow-lg');
            standardBtn.classList.add('bg-neutral-900', 'border-neutral-700', 'text-neutral-400');
            updateResult();
          });
          standardBtn.addEventListener('click', () => {
            siteType = 'standard';
            pages = 5;
            if (pagesEl && pagesValue) {
              (pagesEl as HTMLInputElement).value = '5';
              pagesValue.textContent = '5';
            }
            standardBtn.classList.add('bg-neutral-800', 'border-teal-200', 'text-white', 'shadow-lg');
            standardBtn.classList.remove('bg-neutral-900', 'border-neutral-700', 'text-neutral-400');
            customBtn.classList.remove('bg-neutral-800', 'border-teal-200', 'text-white', 'shadow-lg');
            customBtn.classList.add('bg-neutral-900', 'border-neutral-700', 'text-neutral-400');
            updateResult();
          });
        }

        // Calculation logic
        function updateResult(mode: 'website' | 'retainer' | null = null) {
          const isRetainer = (mode === 'retainer') || (document.getElementById('retainerSection')?.style.display !== 'none');
          const includedPack = document.getElementById('includedPack');
          const totalHoursEl = document.getElementById('totalHours');
          const totalPriceEl = document.getElementById('totalPrice');
          const resultTotalLabel = document.getElementById('resultTotalLabel');

          if (isRetainer) {
            // Retainer mode
            const retainerHoursEl = document.getElementById('retainerHours') as HTMLInputElement | null;
            const hours = retainerHoursEl ? parseInt(retainerHoursEl.value, 10) : 20;
            const hourlyRate = 80;
            const total = hours * hourlyRate;
            if (totalHoursEl) totalHoursEl.textContent = `${hours} Hours`;
            if (totalPriceEl) totalPriceEl.textContent = `$${total.toLocaleString()}`;
            if (includedPack) {
              includedPack.innerHTML = `
                <li>Block of hours (customizable)</li>
                <li>Completely custom to your needs (design, development, support, etc.)</li>
              `;
            }
            if (contactBtnLink) contactBtnLink.textContent = "Discuss your project";
            if (resultTotalLabel) resultTotalLabel.textContent = 'TOTAL';
          } else {
            // Website calculator mode
            let baseHours, featureHours, pageHours, packHours, totalHours;
            let hourlyRate = 85;
            let totalPrice;
            if (siteType === 'custom') {
              baseHours = 100;
              featureHours = features.length * 5;
              pageHours = Math.max(0, pages - 10) * 2;
              totalHours = baseHours + featureHours + pageHours;
              totalPrice = Math.round(totalHours * hourlyRate);
            } else if (siteType === 'standard') {
              baseHours = 60;
              featureHours = features.length * 5;
              pageHours = Math.max(0, pages - 10) * 2;
              totalHours = baseHours + featureHours + pageHours;
              totalPrice = Math.round(totalHours * hourlyRate);
            }
            if (totalHoursEl) totalHoursEl.textContent = `${totalHours} Hours`;
            if (totalPriceEl && totalPrice !== undefined) totalPriceEl.textContent = `${currency === 'USD' ? '$' : currency === 'GBP' ? '£' : '€'}${totalPrice.toLocaleString()}`;
            if (includedPack) {
              if (siteType === 'custom') {
                includedPack.innerHTML = `
                  <li>Sitemap</li>
                  <li>10 page templates</li>
                  <li>Wireframes</li>
                  <li>Custom theme integration</li>
                  <li>Responsive layout</li>
                  <li>Testing & go-live</li>
                  <li>Training</li>
                `;
              } else if (siteType === 'standard') {
                includedPack.innerHTML = `
                  <li>Sitemap</li>
                  <li>5 page templates</li>
                  <li>Responsive layout</li>
                  <li>Testing & go-live</li>
                  <li>Training</li>
                `;
              }
            }
            if (contactBtnLink) contactBtnLink.textContent = "Schedule a Meeting";
            if (resultTotalLabel) resultTotalLabel.textContent = 'TOTAL';
          }
        }
        updateResult();

        // Sliders Logic
        const retainerHoursEl = document.getElementById('retainerHours') as HTMLInputElement | null;
        const retainerHoursValue = document.getElementById('retainerHoursValue');
        if (retainerHoursEl && retainerHoursValue) {
          retainerHoursEl.addEventListener('input', () => {
             retainerHoursValue.textContent = String(retainerHoursEl.value);
             updateResult('retainer');
          });
        }

        if (pagesEl && pagesValue) {
          pagesEl.addEventListener('input', () => {
            pages = parseInt((pagesEl as HTMLInputElement).value, 10);
            pagesValue.textContent = pages.toString();
            updateResult('website');
          });
        }

        // Tab Switching
        const tabWebsite = document.getElementById('tabWebsite') as HTMLButtonElement | null;
        const tabRetainer = document.getElementById('tabRetainer') as HTMLButtonElement | null;
        const websiteSection = document.getElementById('websiteSection');
        const retainerSection = document.getElementById('retainerSection');

        if (tabWebsite && tabRetainer && websiteSection && retainerSection) {
          tabWebsite.addEventListener('click', function(e) {
            e.preventDefault();
            tabWebsite.classList.add('border-teal-200', 'bg-neutral-800', 'text-teal-200');
            tabWebsite.classList.remove('border-transparent', 'bg-neutral-900', 'text-neutral-400');
            tabRetainer.classList.remove('border-teal-200', 'bg-neutral-800', 'text-teal-200');
            tabRetainer.classList.add('border-transparent', 'bg-neutral-900', 'text-neutral-400');
            websiteSection.style.display = '';
            retainerSection.style.display = 'none';
            updateResult('website');
          });
          tabRetainer.addEventListener('click', function(e) {
            e.preventDefault();
            tabRetainer.classList.add('border-teal-200', 'bg-neutral-800', 'text-teal-200');
            tabRetainer.classList.remove('border-transparent', 'bg-neutral-900', 'text-neutral-400');
            tabWebsite.classList.remove('border-teal-200', 'bg-neutral-800', 'text-teal-200');
            tabWebsite.classList.add('border-transparent', 'bg-neutral-900', 'text-neutral-400');
            websiteSection.style.display = 'none';
            retainerSection.style.display = '';
            updateResult('retainer');
          });
        }
      });
    </script>
  </main>
  <Footer />
</Layout>